<svg width="800" height="400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="600" fill="#333">Knowledge Base Access</text>

  <!-- user_sessions -->
  <rect x="20" y="60" width="160" height="40" fill="none" stroke="#4A90E2" stroke-width="2" rx="5"/>
  <text x="100" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">user_sessions</text>

  <!-- user_kb_associations -->
  <rect x="240" y="60" width="160" height="40" fill="none" stroke="#50E3C2" stroke-width="2" rx="5"/>
  <text x="320" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">user_kb_associations</text>

  <!-- kb_collections -->
  <rect x="20" y="180" width="160" height="40" fill="none" stroke="#7ED321" stroke-width="2" rx="5"/>
  <text x="100" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">kb_collections</text>

  <!-- kb_documents -->
  <rect x="240" y="180" width="160" height="40" fill="none" stroke="#F5A623" stroke-width="2" rx="5"/>
  <text x="320" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">kb_documents</text>

  <!-- Vector Storage -->
  <rect x="460" y="180" width="160" height="40" fill="none" stroke="#BD10E0" stroke-width="2" rx="5"/>
  <text x="540" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">Vector Storage</text>

  <!-- Field details -->
  <g font-family="Arial, sans-serif" font-size="11" fill="#666">
    <!-- user_sessions fields -->
    <text x="30" y="120">id, user_id</text>
    <text x="30" y="135">bot_id, session_token</text>

    <!-- user_kb_associations fields -->
    <text x="250" y="120">id, session_id</text>
    <text x="250" y="135">kb_id, created_at</text>

    <!-- kb_collections fields -->
    <text x="30" y="240">id, bot_id, name</text>
    <text x="30" y="255">created_at, metadata</text>

    <!-- kb_documents fields -->
    <text x="250" y="240">id, collection_id</text>
    <text x="250" y="255">content, embeddings</text>

    <!-- Vector Storage info -->
    <text x="470" y="240">Embeddings stored</text>
    <text x="470" y="255">for semantic search</text>
  </g>

  <!-- Arrows -->
  <g stroke="#666" stroke-width="2" fill="none">
    <!-- user_sessions to user_kb_associations -->
    <line x1="180" y1="80" x2="240" y2="80" marker-end="url(#arrow)"/>

    <!-- user_kb_associations references kb_collections (dashed) -->
    <path d="M320,100 Q320,140 100,140 Q100,160 100,180" stroke-dasharray="3,3" marker-end="url(#arrow)" opacity="0.6"/>

    <!-- kb_collections to kb_documents -->
    <line x1="180" y1="200" x2="240" y2="200" marker-end="url(#arrow)"/>

    <!-- kb_documents to Vector Storage -->
    <line x1="400" y1="200" x2="460" y2="200" marker-end="url(#arrow)"/>
  </g>

  <!-- Relationship labels -->
  <text x="210" y="75" font-family="Arial, sans-serif" font-size="11" fill="#666">Has Access</text>
  <text x="210" y="195" font-family="Arial, sans-serif" font-size="11" fill="#666">Contains</text>
  <text x="210" y="210" font-family="Arial, sans-serif" font-size="11" fill="#666">1:N</text>
  <text x="430" y="195" font-family="Arial, sans-serif" font-size="11" fill="#666">Indexes</text>
  <text x="210" y="140" font-family="Arial, sans-serif" font-size="11" fill="#666">References</text>

  <!-- Access Pattern Box -->
  <g transform="translate(460, 60)">
    <rect width="320" height="90" fill="none" stroke="#666" stroke-width="1" rx="5" opacity="0.3"/>
    <text x="10" y="20" font-family="Arial, sans-serif" font-size="12" font-weight="600" fill="#333">Access Pattern:</text>
    <text x="10" y="40" font-family="Arial, sans-serif" font-size="12" fill="#666">1. Session requests KB access</text>
    <text x="10" y="55" font-family="Arial, sans-serif" font-size="12" fill="#666">2. Association created in user_kb_associations</text>
    <text x="10" y="70" font-family="Arial, sans-serif" font-size="12" fill="#666">3. KB documents become available</text>
    <text x="10" y="85" font-family="Arial, sans-serif" font-size="12" fill="#666">4. Vector search enabled on embeddings</text>
  </g>

  <!-- Description -->
  <text x="400" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    Sessions gain access to knowledge bases through associations, enabling vector search on document embeddings
  </text>
  <text x="400" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    Each collection contains multiple documents with pre-computed embeddings for semantic search
  </text>
  <text x="400" y="360" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    Access is controlled per session, allowing dynamic knowledge base selection during conversations
  </text>
</svg>

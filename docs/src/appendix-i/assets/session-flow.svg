<svg width="800" height="320" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="600" fill="#333">Session Flow Diagram</text>

  <!-- User Login -->
  <rect x="20" y="60" width="100" height="40" fill="none" stroke="#4A90E2" stroke-width="2" rx="5"/>
  <text x="70" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">User Login</text>

  <!-- users table -->
  <rect x="180" y="60" width="100" height="40" fill="none" stroke="#F5A623" stroke-width="2" rx="5"/>
  <text x="230" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">users</text>

  <!-- user_sessions table -->
  <rect x="340" y="60" width="120" height="40" fill="none" stroke="#BD10E0" stroke-width="2" rx="5"/>
  <text x="400" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">user_sessions</text>

  <!-- message_history table -->
  <rect x="520" y="60" width="120" height="40" fill="none" stroke="#7ED321" stroke-width="2" rx="5"/>
  <text x="580" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">message_history</text>

  <!-- Session Token -->
  <rect x="700" y="60" width="80" height="40" fill="none" stroke="#50E3C2" stroke-width="2" rx="5"/>
  <text x="740" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">Token</text>

  <!-- Additional Tables -->
  <rect x="180" y="160" width="140" height="40" fill="none" stroke="#4A90E2" stroke-width="2" rx="5"/>
  <text x="250" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">user_login_tokens</text>

  <rect x="360" y="160" width="160" height="40" fill="none" stroke="#F5A623" stroke-width="2" rx="5"/>
  <text x="440" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">user_kb_associations</text>

  <rect x="560" y="160" width="180" height="40" fill="none" stroke="#7ED321" stroke-width="2" rx="5"/>
  <text x="650" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">session_tool_associations</text>

  <!-- Field Details -->
  <g font-family="Arial, sans-serif" font-size="11" fill="#666">
    <!-- users fields -->
    <text x="190" y="115">id, email</text>
    <text x="190" y="130">zitadel_id</text>

    <!-- user_sessions fields -->
    <text x="350" y="115">id, user_id, bot_id</text>
    <text x="350" y="130">token, expires_at</text>

    <!-- message_history fields -->
    <text x="530" y="115">id, session_id</text>
    <text x="530" y="130">role, content</text>

    <!-- Token info -->
    <text x="710" y="115">JWT/UUID</text>
    <text x="710" y="130">Auth</text>

    <!-- user_login_tokens fields -->
    <text x="190" y="215">id, user_id, token</text>
    <text x="190" y="230">expires_at</text>

    <!-- user_kb_associations fields -->
    <text x="370" y="215">id, session_id</text>
    <text x="370" y="230">kb_id, created_at</text>

    <!-- session_tool_associations fields -->
    <text x="570" y="215">id, session_id</text>
    <text x="570" y="230">tool_name, added_at</text>
  </g>

  <!-- Flow Arrows -->
  <g stroke="#666" stroke-width="2" fill="none">
    <!-- Main flow -->
    <line x1="120" y1="80" x2="180" y2="80" marker-end="url(#arrow)"/>
    <line x1="280" y1="80" x2="340" y2="80" marker-end="url(#arrow)"/>
    <line x1="460" y1="80" x2="520" y2="80" marker-end="url(#arrow)"/>
    <line x1="640" y1="80" x2="700" y2="80" marker-end="url(#arrow)"/>

    <!-- users to user_login_tokens -->
    <path d="M230,100 Q230,130 250,130 Q250,150 250,160" marker-end="url(#arrow)" opacity="0.6"/>

    <!-- user_sessions to associations -->
    <path d="M400,100 Q400,130 440,130 Q440,150 440,160" marker-end="url(#arrow)" opacity="0.6"/>
    <path d="M460,80 Q550,130 650,160" marker-end="url(#arrow)" opacity="0.6"/>
  </g>

  <!-- Labels -->
  <text x="150" y="75" font-family="Arial, sans-serif" font-size="11" fill="#666">Creates</text>
  <text x="310" y="75" font-family="Arial, sans-serif" font-size="11" fill="#666">Establishes</text>
  <text x="490" y="75" font-family="Arial, sans-serif" font-size="11" fill="#666">Logs</text>
  <text x="670" y="75" font-family="Arial, sans-serif" font-size="11" fill="#666">Returns</text>
  <text x="240" y="145" font-family="Arial, sans-serif" font-size="11" fill="#666">Stores</text>
  <text x="420" y="145" font-family="Arial, sans-serif" font-size="11" fill="#666">Links KB</text>
  <text x="550" y="145" font-family="Arial, sans-serif" font-size="11" fill="#666">Links Tools</text>

  <!-- Process Steps -->
  <g font-family="Arial, sans-serif" font-size="12" fill="#333">
    <circle cx="70" cy="60" r="12" fill="none" stroke="#666" stroke-width="1"/>
    <text x="70" y="65" text-anchor="middle">1</text>

    <circle cx="230" cy="60" r="12" fill="none" stroke="#666" stroke-width="1"/>
    <text x="230" y="65" text-anchor="middle">2</text>

    <circle cx="400" cy="60" r="12" fill="none" stroke="#666" stroke-width="1"/>
    <text x="400" y="65" text-anchor="middle">3</text>

    <circle cx="580" cy="60" r="12" fill="none" stroke="#666" stroke-width="1"/>
    <text x="580" y="65" text-anchor="middle">4</text>

    <circle cx="740" cy="60" r="12" fill="none" stroke="#666" stroke-width="1"/>
    <text x="740" y="65" text-anchor="middle">5</text>
  </g>

  <!-- Process Description Box -->
  <g transform="translate(20, 250)">
    <rect width="760" height="50" fill="none" stroke="#666" stroke-width="1" rx="5" opacity="0.3"/>
    <text x="10" y="20" font-family="Arial, sans-serif" font-size="12" font-weight="600" fill="#333">Process Flow:</text>
    <text x="10" y="40" font-family="Arial, sans-serif" font-size="12" fill="#666">1. User authenticates → 2. User record created/updated → 3. Session established → 4. Messages logged → 5. Token returned</text>
  </g>

  <!-- Description -->
  <text x="400" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    Authentication flow from login through session establishment and message tracking
  </text>
</svg>
